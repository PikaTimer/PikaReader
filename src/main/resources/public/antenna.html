<!DOCTYPE html>
<!--
Copyright (C) 2023 John Garner <segfaultcoredump@gmail.com>

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<!DOCTYPE html>
<html lang="en">
    <head>
        <script src="/js/chart-4.4.1.js"></script>
    </head>
    <body>
        <div class="chart-container" style="position: relative; height:40vh; width:100vw">
            <canvas id="reader1"></canvas>
        </div>
        <div class="chart-container" style="position: relative; height:40vh; width:100vw">
            <canvas id="reader2"></canvas>
        </div>
        <div class="chart-container" style="position: relative; height:40vh; width:100vw">
            <canvas id="reader3"></canvas>
        </div>
        <script>
            var chartData = [0, 0, 0, 0];
            const ctx = document.getElementById("reader1");
            const myChart = new Chart(ctx, {
                type: "bar",
                data: {
                    labels: ["Port 1", "Port 2", "Port 3", "Port 4"],
                    datasets: [
                        {
                            label: "Reader 1",
                            data: chartData,
                            backgroundColor: [
                                "rgba(214, 43, 43, 0.8)",
                                "rgba(214, 43, 43, 0.8)",
                                "rgba(214, 43, 43, 0.8)",
                                "rgba(214, 43, 43, 0.8)"
                            ],
                            borderColor: [
                                "rgba(10,10,10, 1)",
                                "rgba(10,10,10, 1)",
                                "rgba(10,10,10, 1)",
                                "rgba(10,10,10, 1)"
                            ],
                            borderWidth: 1,
                            base: -100
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            //beginAtZero: true,
                            //reverse: true,
                            min: -90,
                            max: -30,
                            title: {
                                display: true,
                                text: 'RSSI dBm'
                            }
                        }
                    }
                }
            });
            
            var eventSocket = "ws://" + window.location.host + "/events";
            console.log("Server Host" + window.location.host);

            webSocket = new WebSocket(eventSocket);
            webSocket.onmessage = function (message) {
                const data = message.data;
                const status = JSON.parse(data);


                if (status.type === "STATUS") {
                    console.log("Status Message");
                    chartData = status["readStrength"]["Reader 1"];
                    myChart.data.datasets[0].data = chartData;
                    myChart.update();
                }

            };
        </script>
    </body>
</html>